<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ±‡ç‡è¯¦æƒ… - å­é¡µé¢</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .glass-effect {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }

    .loading-spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 4px solid #ffffff;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .currency-card {
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .currency-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .table-row:hover {
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.1), rgba(168, 85, 247, 0.1)) !important;
      transform: scale(1.01);
      transition: all 0.2s ease;
    }

    .rate-table {
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body class="min-h-screen">
  <div id="app" class="container mx-auto px-4 py-8">
    <!-- å¯¼èˆªæ  -->
    <nav class="flex justify-between items-center mb-8">
      <button @click="goBack" class="glass-effect px-6 py-3 rounded-xl text-white font-bold hover:bg-white/30 transition-all transform hover:scale-105 flex items-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        {{ t('backToCurrencyList') }}
      </button>

      <!-- è¯­è¨€åˆ‡æ¢ -->
      <div class="glass-effect rounded-xl p-2">
        <button @click="switchLanguage('zh-CN')" :class="['px-4 py-2 rounded-lg font-bold transition-all', currentLocale === 'zh-CN' ? 'bg-blue-500 text-white' : 'text-gray-700 hover:bg-white/30']">
          ä¸­æ–‡
        </button>
        <button @click="switchLanguage('en-US')" :class="['px-4 py-2 rounded-lg font-bold transition-all', currentLocale === 'en-US' ? 'bg-blue-500 text-white' : 'text-gray-700 hover:bg-white/30']">
          English
        </button>
      </div>
    </nav>

    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <nav class="mb-6">
      <ol class="flex items-center space-x-2 text-white text-sm">
        <li>
          <a href="/" class="hover:underline">{{ t('currencyList') }}</a>
        </li>
        <li>
          <svg class="w-4 h-4 mx-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </li>
        <li>
          <a :href="'/currencies-rate/' + baseCurrency" class="hover:underline">{{ baseCurrency }}æ±‡ç‡è¯¦æƒ…</a>
        </li>
        <li>
          <svg class="w-4 h-4 mx-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </li>
        <li aria-current="page" class="font-medium">{{ baseCurrency }} â†’ {{ targetCurrency }} æ±‡ç‡è¯¦æƒ…</li>
      </ol>
    </nav>

    <!-- é¡µé¢æ ‡é¢˜ -->
    <header class="mb-8 text-center fade-in">
      <h1 class="text-4xl font-bold text-white mb-4 drop-shadow-lg">
        ğŸ’± {{ baseCurrency }} â†’ {{ targetCurrency }} {{ t('exchangeRateDetails') }}
      </h1>
      <div class="glass-effect rounded-2xl p-6 max-w-2xl mx-auto">
        <h2 class="text-2xl font-bold text-gray-800">
          {{ baseCurrency }} {{ t('exchangeRateHistory') }} {{ targetCurrency }}
        </h2>
      </div>
    </header>

    <main>
      <!-- æ§åˆ¶åŒºåŸŸ -->
      <div class="glass-effect rounded-2xl p-8 mb-8 fade-in">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- åŸºç¡€è´§å¸å’Œç›®æ ‡è´§å¸æ˜¾ç¤º -->
          <div>
            <label class="block text-lg font-bold text-gray-800 mb-4 flex items-center">
              <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
              </svg>
              è´§å¸å¯¹ä¿¡æ¯
            </label>
            <div class="grid grid-cols-2 gap-4">
              <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-xl text-center">
                <div class="text-sm opacity-75">åŸºç¡€è´§å¸</div>
                <div class="text-2xl font-bold">{{ baseCurrency }}</div>
                <div class="text-xs">{{ getCurrencyName(baseCurrency) }}</div>
              </div>
              <div class="bg-gradient-to-r from-green-500 to-teal-500 text-white p-4 rounded-xl text-center">
                <div class="text-sm opacity-75">ç›®æ ‡è´§å¸</div>
                <div class="text-2xl font-bold">{{ targetCurrency }}</div>
                <div class="text-xs">{{ getCurrencyName(targetCurrency) }}</div>
              </div>
            </div>
          </div>

          <!-- å¤©æ•°é€‰æ‹©å™¨ -->
          <div>
            <label class="block text-lg font-bold text-gray-800 mb-4 flex items-center">
              <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              {{ t('viewHistoryDays') }}
            </label>
            <div class="flex flex-wrap gap-3">
              <button v-for="day in [1, 7, 30, 90, 180, 365]" :key="day"
                :class="['px-6 py-3 rounded-xl font-bold transition-all transform hover:scale-105 shadow-md', 
                                            days === day ? 'bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-lg' : 'bg-white text-gray-700 hover:bg-gray-50 border border-gray-200']"
                @click="selectDays(day)">
                {{ day }}{{ t('days') }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- æ±‡ç‡æ•°æ®è¡¨æ ¼ -->
      <div v-if="targetCurrencyRates.length > 0" class="rate-table glass-effect rounded-2xl overflow-hidden mb-8 fade-in">
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-8">
          <h2 class="text-3xl font-bold text-white flex items-center">
            <svg class="w-8 h-8 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
              </path>
            </svg>
            {{ baseCurrency }} â†’ {{ targetCurrency }} {{ t('exchangeRateData') }}
          </h2>
          <p class="text-blue-100 mt-3 text-lg">ğŸ“Š {{ t('recentTrends') }} (æœ€è¿‘ {{ days }} å¤©)</p>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="bg-gradient-to-r from-gray-50 to-gray-100">
                <th class="px-8 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider border-b border-gray-200">
                  ğŸ“… {{ t('date') }}
                </th>
                <th class="px-8 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider border-b border-gray-200">
                  ğŸ’° {{ t('baseCurrency') }}
                </th>
                <th class="px-8 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider border-b border-gray-200">
                  ğŸ’± {{ t('targetCurrency') }}
                </th>
                <th class="px-8 py-4 text-left text-sm font-bold text-gray-700 uppercase tracking-wider border-b border-gray-200">
                  ğŸ“ˆ {{ t('exchangeRate') }}
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
              <tr v-for="(rate, index) in targetCurrencyRates" :key="rate.id"
                :class="['table-row', index % 2 === 0 ? 'bg-white' : 'bg-gray-50']">
                <td class="px-8 py-4 whitespace-nowrap text-sm font-semibold text-gray-800">
                  {{ rate.rate_date }}
                </td>
                <td class="px-8 py-4 whitespace-nowrap text-sm font-bold text-blue-600">
                  {{ rate.base_currency }}
                </td>
                <td class="px-8 py-4 whitespace-nowrap text-sm font-bold text-green-600">
                  {{ rate.target_currency }}
                </td>
                <td class="px-8 py-4 whitespace-nowrap">
                  <span class="text-xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                    {{ rate.exchange_rate }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- åŠ è½½çŠ¶æ€ -->
      <div v-if="loading" class="text-center py-16 fade-in">
        <div class="loading-spinner w-16 h-16 mx-auto mb-6"></div>
        <p class="text-white text-lg font-medium">{{ t('loading') }}</p>
      </div>

      <!-- é”™è¯¯ä¿¡æ¯ -->
      <div v-if="error" class="text-center py-16 glass-effect rounded-2xl p-8 max-w-md mx-auto fade-in">
        <div class="text-red-500 text-8xl mb-6 animate-pulse">âš ï¸</div>
        <p class="text-red-600 font-medium text-lg mb-4">{{ t('error') }}: {{ error }}</p>
        <button @click="fetchTargetCurrencyRates()"
          class="px-8 py-3 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-xl hover:from-red-600 hover:to-pink-600 transition-all transform hover:scale-105 shadow-lg">
          é‡æ–°åŠ è½½
        </button>
      </div>

      <!-- æ— æ•°æ®æç¤º -->
      <div v-if="!loading && !error && targetCurrencyRates.length === 0" class="text-center py-16 glass-effect rounded-2xl p-8 max-w-md mx-auto fade-in">
        <div class="text-gray-500 text-8xl mb-6">ğŸ“Š</div>
        <p class="text-gray-600 font-medium text-lg mb-4">{{ t('noData') }}</p>
        <p class="text-gray-500 text-sm">æš‚æ—¶æ²¡æœ‰æ‰¾åˆ° {{ baseCurrency }} â†’ {{ targetCurrency }} çš„å†å²æ±‡ç‡æ•°æ®</p>
      </div>
    </main>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          baseCurrency: '',
          targetCurrency: '',
          targetCurrencyRates: [],
          loading: false,
          error: null,
          days: 7,
          currentLocale: 'zh-CN',
          translations: {
            'zh-CN': {
              'backToCurrencyList': 'è¿”å›è´§å¸åˆ—è¡¨',
              'currencyList': 'è´§å¸åˆ—è¡¨',
              'exchangeRateDetails': 'æ±‡ç‡è¯¦æƒ…',
              'exchangeRateHistory': 'æ±‡ç‡å†å²',
              'exchangeRateData': 'æ±‡ç‡æ•°æ®',
              'recentTrends': 'è¿‘æœŸè¶‹åŠ¿',
              'date': 'æ—¥æœŸ',
              'baseCurrency': 'åŸºç¡€è´§å¸',
              'targetCurrency': 'ç›®æ ‡è´§å¸',
              'exchangeRate': 'æ±‡ç‡',
              'viewHistoryDays': 'æŸ¥çœ‹å†å²å¤©æ•°',
              'days': 'å¤©',
              'loading': 'åŠ è½½ä¸­...',
              'error': 'é”™è¯¯',
              'noData': 'æš‚æ— æ•°æ®'
            },
            'en-US': {
              'backToCurrencyList': 'Back to Currency List',
              'currencyList': 'Currency List',
              'exchangeRateDetails': 'Exchange Rate Details',
              'exchangeRateHistory': 'Exchange Rate History',
              'exchangeRateData': 'Exchange Rate Data',
              'recentTrends': 'Recent Trends',
              'date': 'Date',
              'baseCurrency': 'Base Currency',
              'targetCurrency': 'Target Currency',
              'exchangeRate': 'Exchange Rate',
              'viewHistoryDays': 'View History Days',
              'days': 'Days',
              'loading': 'Loading...',
              'error': 'Error',
              'noData': 'No data available'
            }
          }
        }
      },

      computed: {
        t() {
          return (key) => {
            return this.translations[this.currentLocale]?.[key] || key;
          }
        }
      },

      methods: {
        goBack() {
          window.history.back();
        },

        switchLanguage(locale) {
          this.currentLocale = locale;
        },

        selectDays(days) {
          this.days = days;
          this.fetchTargetCurrencyRates();
        },

        getCurrencyName(currency) {
          const currencyNames = {
            'USD': 'ç¾å…ƒ',
            'EUR': 'æ¬§å…ƒ',
            'GBP': 'è‹±é•‘',
            'JPY': 'æ—¥å…ƒ',
            'CNY': 'äººæ°‘å¸',
            'CAD': 'åŠ å…ƒ',
            'AUD': 'æ¾³å…ƒ',
            'CHF': 'ç‘å£«æ³•éƒ',
            'HKD': 'æ¸¯å¸',
            'SGD': 'æ–°åŠ å¡å…ƒ',
            'KRW': 'éŸ©å…ƒ',
            'INR': 'å°åº¦å¢æ¯”',
            'BRL': 'å·´è¥¿é›·äºšå°”',
            'RUB': 'ä¿„ç½—æ–¯å¢å¸ƒ',
            'MXN': 'å¢¨è¥¿å“¥æ¯”ç´¢',
            'IDR': 'å°å°¼ç›¾',
            'TRY': 'åœŸè€³å…¶é‡Œæ‹‰',
            'SAR': 'æ²™ç‰¹é‡Œäºšå°”',
            'AED': 'é˜¿è”é…‹è¿ªæ‹‰å§†',
            'THB': 'æ³°é“¢',
            'MYR': 'é©¬æ¥è¥¿äºšæ—å‰ç‰¹',
            'PHP': 'è²å¾‹å®¾æ¯”ç´¢',
            'VND': 'è¶Šå—ç›¾',
            'ZAR': 'å—éå…°ç‰¹',
            'NZD': 'æ–°è¥¿å…°å…ƒ'
          };
          return currencyNames[currency] || currency;
        },

        async fetchTargetCurrencyRates() {
          if (!this.targetCurrency) return;

          this.loading = true;
          this.error = null;

          try {
            const response = await fetch('/target-currency-rates', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                target_currency: this.targetCurrency,
                base_currency: this.baseCurrency,
                datetime: this.days
              })
            });

            if (!response.ok) {
              throw new Error('è·å–æ±‡ç‡æ•°æ®å¤±è´¥');
            }

            const data = await response.json();
            this.targetCurrencyRates = data.historicalRates || [];
          } catch (err) {
            this.error = err.message;
            console.error('Error fetching target currency rates:', err);
          } finally {
            this.loading = false;
          }
        },

        initCurrencies() {
          // ä»URLè·¯å¾„ä¸­è·å–åŸºç¡€è´§å¸å’Œç›®æ ‡è´§å¸
          const pathParts = window.location.pathname.split('/');
          this.baseCurrency = pathParts[pathParts.length - 2] || 'EUR';
          this.targetCurrency = pathParts[pathParts.length - 1] || 'USD';

          // ä»URLå‚æ•°ä¸­è·å–å¤©æ•°
          const urlParams = new URLSearchParams(window.location.search);
          this.days = parseInt(urlParams.get('days')) || 7;

          if (this.baseCurrency && this.targetCurrency) {
            this.fetchTargetCurrencyRates();
          }
        }
      },

      mounted() {
        this.initCurrencies();
      }
    }).mount('#app');
  </script>
</body>
</html>